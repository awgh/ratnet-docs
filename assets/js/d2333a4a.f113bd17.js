"use strict";(self.webpackChunkratnet=self.webpackChunkratnet||[]).push([[448],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return d}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),p=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),m=p(n),d=a,h=m["".concat(l,".").concat(d)]||m[d]||u[d]||i;return n?r.createElement(h,o(o({ref:t},c),{},{components:n})):r.createElement(h,o({ref:t},c))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,o=new Array(i);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:a,o[1]=s;for(var p=2;p<i;p++)o[p]=n[p];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},9952:function(e,t,n){n.r(t),n.d(t,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return s},metadata:function(){return p},toc:function(){return u}});var r=n(7462),a=n(3366),i=(n(7294),n(3905)),o=["components"],s={sidebar_position:2},l="Transport Interface",p={unversionedId:"api/transports/api",id:"api/transports/api",title:"Transport Interface",description:"To create a new transport, the Transport interface must be implemented.  This is the only interface required for a new Transport.",source:"@site/docs/api/transports/api.md",sourceDirName:"api/transports",slug:"/api/transports/api",permalink:"/ratnet-docs/docs/api/transports/api",draft:!1,editUrl:"https://github.com/awgh/ratnet-docs/tree/gh-pages/docs/api/transports/api.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Transports",permalink:"/ratnet-docs/docs/api/transports/intro"},next:{title:"Crypto in Ratnet",permalink:"/ratnet-docs/docs/api/crypto/intro"}},c={},u=[{value:"Listen",id:"listen",level:2},{value:"Name",id:"name",level:2},{value:"RPC",id:"rpc",level:2},{value:"Stop",id:"stop",level:2},{value:"ByteLimit / SetByteLimit",id:"bytelimit--setbytelimit",level:2},{value:"MarshallJSON",id:"marshalljson",level:2}],m={toc:u};function d(e){var t=e.components,n=(0,a.Z)(e,o);return(0,i.kt)("wrapper",(0,r.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"transport-interface"},"Transport Interface"),(0,i.kt)("p",null,"To create a new transport, the Transport interface must be implemented.  This is the only interface required for a new Transport."),(0,i.kt)("p",null,"In this section, we'll go through each of the functions in the Transport interface."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:'"','"':!0},"type Transport interface {\n    Listen(listen string, adminMode bool)\n    Name() string\n    RPC(host string, method Action, args ...interface{}) (interface{}, error)\n    Stop()\n\n    ByteLimit() int64 \n    SetByteLimit(limit int64)\n\n    JSON\n}\n\ntype JSON interface {\n    MarshalJSON() (b []byte, e error)\n}\n")),(0,i.kt)("h2",{id:"listen"},"Listen"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:'"','"':!0},"    Listen(listen string, adminMode bool)\n")),(0,i.kt)("p",null,"Listen is expected to start the message listening loop as a goroutine and then return.  If the message listening loop is already running, Listen should just exit."),(0,i.kt)("p",null,"When a message is received from a remote client, the message listening loop should convert that message from bytes into an api.RemoteCall struct (perhaps using api.RemoteCallFromBytes) and then pass that RemoteCall into either the AdminRPC or PublicRPC functions of the ratnet node this transport instance is attached to."),(0,i.kt)("p",null,"When the RemoteCall is run on the node, the message listening loop should take the response and serialize it into an api.RemoteResponse struct (perhaps using api.RemoteResponseToBytes) and return that to the client.  If your transport does not support bi-directional communication, you can skip sending these RemoteResponses."),(0,i.kt)("p",null,"Listen takes two arguments:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"listen (string)"),(0,i.kt)("p",{parentName:"li"},'Opaque argument passed to an instance of the transport when it starts listening.  In the case of network protocols, this is frequently a host:port listen string (ie. ":443").  For transports that might use non-IP radios or networking, this could be a capcode or a frequency or a sound card or a serial port, etc.')),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"adminMode (bool) "),(0,i.kt)("p",{parentName:"li"},"This flag determines whether this transport is currently being used to access the administrative backend API of ratnet, rather than the public API.  Should default to false, true is insecure on a public bus!  Transport implementations will only use this flag to determine how they call into the ratnet node, as shown here:"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/awgh/ratnet/blob/master/transports/tls/tls.go#L130-L135\n")))),(0,i.kt)("h2",{id:"name"},"Name"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:'"','"':!0},"    Name() string\n")),(0,i.kt)("p",null,'Name must return a unique string identifier for this transport.  The UDP transport returns "udp", TCP returns "tcp" and so on.  This string will be used in the peer table in URI schemas, such as "udp://host:port", so they should be short, descriptive, and human-readable.'),(0,i.kt)("h2",{id:"rpc"},"RPC"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go",metastring:'"','"':!0},"    RPC(host string, method Action, args ...interface{}) (interface{}, error)\n")),(0,i.kt)("h2",{id:"stop"},"Stop"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"    Stop()\n")),(0,i.kt)("p",null,"Stop will halt any background listening loops and clean up any resources allocated or held by this transport instance.  "),(0,i.kt)("h2",{id:"bytelimit--setbytelimit"},"ByteLimit / SetByteLimit"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"    ByteLimit() int64 \n    SetByteLimit(limit int64)\n")),(0,i.kt)("p",null,"The ByteLimit field of a transport sets the maximum size for a message bundle.  Individual messages that are too large to fit in a single bundle will be automatically chunked into smaller messages, with the chunk size set to the smallest ByteLimit of this instance's transports."),(0,i.kt)("p",null,"Transport implementations can chose to ignore SetByteLimit calls if their transport has a fixed ByteLimit."),(0,i.kt)("p",null,"If you're wondering what SetByteLimit is even used for... it's currently useful for things with fixed timeouts where you might want to dynamically adjust the MTU, like UDP and unit tests.  "),(0,i.kt)("h2",{id:"marshalljson"},"MarshallJSON"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"MarshalJSON() (b []byte, e error)\n")),(0,i.kt)("p",null,"Serialize this type to JSON."))}d.isMDXComponent=!0}}]);